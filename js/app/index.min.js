let tAccountLicenses,dataSet=null;function myFunction(e){$(location).attr("href",e)}$.ajax({url:"https://dashboard.8thsensus.com:8080/message",headers:{"Content-Type":"application/x-www-form-urlencoded"},type:"GET",dataType:"json",data:{},success:function(e){startOfWeek="2021-04-05T01:35:35.648732Z";alasql("SELECT COUNT(diagcode) FROM ? order by utc",[e]);var t,o,n,a,s,r,d=new Date,c=new Date;d.setHours(0,0,0,0),c.setHours(0,0,0,0);var l=[],u=[],g=[],h=[];for(function(){const t=moment(),o=moment(t.startOf("day")).format(),i=moment(t.endOf("day")).format(),d=moment();moment(d.startOf("day")).format(),moment(d.endOf("day")).format();console.log(o+" - "+i),n=alasql("SELECT COUNT(distinct UPPER(userid)) as licenses FROM ?",[e]),a=alasql("SELECT COUNT(DISTINCT userid) devices FROM ?",[e]),s=alasql("SELECT COUNT(DISTINCT userid) intrusions FROM ? WHERE utc >= '"+o+"' and utc < '"+i+"' and (diagcode = 'D0011' or diagcode = 'D0012') order by utc",[e]),r=alasql("SELECT COUNT(userid) alerts FROM ? WHERE utc >= '"+o+"' and utc < '"+i+"' order by utc",[e]);var c=n[0].licenses,l=a[0].devices;console.log(l);var u=s[0].intrusions,g=r[0].alerts;$("#licUser").html(c),tAccountLicenses=c,$("#activeUsers_24hours").html(c);let h=c;console.log(c);var f={labels:["Active","Inactive"],datasets:[{data:[h,0],backgroundColor:["#a3e1d4","#dedede"]}]},p={legend:{display:!0},responsive:!0,title:{display:!0,text:"Total Licenses:"+c,verticalAlign:"center",textAlign:"center",textBaseline:"middle"}},m=document.getElementById("doughnutChart").getContext("2d");new Chart(m,{type:"doughnut",data:f,options:p});var y={legend:{display:!0},responsive:!0,scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0}]},interaction:{intersect:!1},onClick:function(e){var t=this.getElementsAtEvent(e)[0]._model.label;location.href="logs.html?day="+t}},S=document.getElementById("lineChart").getContext("2d");new Chart(S,{type:"bar",data:{labels:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],datasets:[{label:"Alerts",backgroundColor:"rgba(26,179,148,0.5)",borderColor:"rgba(26,179,148,0.7)",pointBackgroundColor:"rgba(26,179,148,1)",pointBorderColor:"#fff",data:[28,48,40,19,86,27,90],stack:"Stack 0"},{label:"Intrusions",backgroundColor:"rgba(220, 220, 220, 0.5)",pointBorderColor:"#fff",data:[65,59,80,81,56,55,40],stack:"Stack 1"}]},options:y}),$("#devices").html(l),$("#activeDevices_24hours").html(l),$("#intrusions").html(u),$("#intrusions_24hours").html(u),$("#alerts").html(g)}(),i=0;i<24;i++)t=moment(d.setHours(d.getHours()+i)).format(),o=moment(c.setHours(c.getHours()+i+1)).format(),n=alasql("SELECT COUNT(DISTINCT userid) licenses FROM ? WHERE utc >= '"+t+"' and utc < '"+o+"' order by utc",[e]),a=alasql("SELECT COUNT(DISTINCT userid) devices FROM ? WHERE utc >= '"+t+"' and utc < '"+o+"' order by utc",[e]),s=alasql("SELECT COUNT(DISTINCT userid) intrusions FROM ? WHERE utc >= '"+t+"' and utc < '"+o+"' and (diagcode = 'D0011' or diagcode = 'D0012') order by utc",[e]),r=alasql("SELECT COUNT(userid) alerts FROM ? WHERE utc >= '"+t+"' and utc < '"+o+"' order by utc",[e]),alasql("SELECT utc FROM ? WHERE utc >= '"+t+"' and utc < '"+o+"' order by utc",[e]),l.push(n[0].licenses),u.push(a[0].devices),g.push(s[0].intrusions),h.push(r[0].alerts),d.setHours(0,0,0,0),c.setHours(0,0,0,0);e.length;var f,p=0,m=[],S=(new Date,new Date,new Date),C=0,E=[],D=!1;for(i=0;i<e.length;i++)if(e[i].length>1){for(new Date(e[i].stamp),oneHoursBefore=new Date(S.getTime()),oneHoursAfter=new Date(S.getTime()-36e5),x=0;x<e.length;x++)f=e[x].stamp,Date.parse(oneHoursBefore)>Date.parse(f)&&Date.parse(oneHoursAfter)<Date.parse(f)&&(C+=1,D=!0);D&&E.push([oneHoursBefore,C]),S=oneHoursAfter,C=0,D=!1}for(y=0;y<e.length;y++)-1===m.indexOf(e[y].userid)&&m.push(e[y].userid);for(y=0;y<m.length;y++)p=1+p;for(p=0,y=0;y<m.length;y++)p=1+p;for(p=0,$.each(e,function(e,t){"D0011"!=t.diagcode&&"D0012"!=t.diagcode||(p=1+p)}),p=0,$.each(e,function(e,t){p=1+p}),i=0;i<100;i++){var v=e[i].gps,T=e[i].gps.split(","),k=e[i].stamp,b=e[i].userid,L=e[i].diagcode,O="",U="",H="",M="";I(T,b,R(k),L,i)}function I(t,o,n,a,s){if(""!==t[0]){H="https://api.bigdatacloud.net/data/reverse-geocode/";(t=e[i].gps.split(","))[0],t[1];M={latitude:t[0],longitude:t[1],localityLanguage:"en",key:"b0067cd12214491aa5317a26c85a007b"}}else{H="https://api.bigdatacloud.net/data/ip-geolocation-with-confidence/";var r=e[i].remoteip;M={ip:r,localityLanguage:"en",key:"d915f9ffc0134077a61239935a7673df"}}$.ajax({type:"GET",url:H,data:M,success:function(e){var t="",r="",i="";""!==v?(t=e.principalSubdivision,r=e.locality,i=e.postcode):(t=e.location.isoPrincipalSubdivision,r=e.location.localityName,i=e.location.postcode);var d,c,l=r+" "+i+", "+t,u=(d=a,c="",$.each({D0001:"Screen Unlocked | Initial Login after reboot | Confidence 1:5,000,000",D0002:"Screen Unlocked | Zero Touch Unlocked authorized user |  1:5,000,000",D0003:"Screen Locked 0 | Zero Touch Locked no user present | Confidence 1:5,000,000",D0004:"Screen Locked 2 | Manual Lock Initiated by authorized user |  1:5,000,000",D0005:"Screen Locked 1| Lock without Camera | Confidence 1:5,000,000",D0006:"Screen Unlocked | Authorized user certified | Confidence 1:25,000,000",D0007:"Screen Locked 2 | Manual Lock Initiated by authorized user | Manual Process",D0008:"Screen Unlocked | Unauthorized user(s) presented |  Confidence 1:5,000,000",D0009:"Screen Locked 1 | Unauthorized user(s) presented  | Confidence 1:5,000,000",D0010:"Screen Unlocked | Authorized user(s) presented | 1:5,000,000",D0011:"Screen Unlocked | Unauthorized user(s) presented | Confidence 1:100,000",D0012:"Screen Locked 3 | Power Savings Lock Initiated | System Process",D0013:"Screen Unlocked | 8th Sensus EVE Stopped | Error",D0014:"Screen Unlocked | Video Conference in progress| Confidence 1:5,000,000",D0015:"Screen Locked 1 | Over the Shoulder unauthorized user(s) presented |  > 1"},function(e,t){d==e&&(c=t)}),c);O=(O=(O=(O=O+"<tr /*onclick=myFunction('"+("../activity_logs/devices/?usrid="+o)+"')*/>")+"<td><i class='fa fa-clock-o'></i> "+n+"</td>")+"<td><a href='Users.html?usrid="+o+"'>"+o+"</td>")+"<td class='text-navy'> <i class='fa fa-level-up'></i>"+u+"</td>",O+="</tr>",$("#intrusion-insights tbody").append(O),O="",s<4&&(U+="<div class='feed-element'>",U+="<div>",U=(U=(U=(U+="<small class='float-right text-navy'>1m ago</small>")+"<strong>"+l+"</strong>")+"<div>"+u+"</div>")+"<small class='text-muted'>"+n+"</small>",U+="</div>",U+="</div>",$("#geo-loc-hotspots").html(U))},error:function(e,t,o){}}).done(function(e){})}function R(e){let t=new Date(e),o=1==t.getMonth().toString().length?"0"+(t.getMonth()+1):t.getMonth()+1,n=1==t.getDate().toString().length?"0"+t.getDate():t.getDate(),a=1==t.getHours().toString().length?"0"+t.getHours():t.getHours(),s=1==t.getMinutes().toString().length?"0"+t.getMinutes():t.getMinutes(),r=1==t.getSeconds().toString().length?"0"+t.getSeconds():t.getSeconds();return t.getFullYear()+"-"+o+"-"+n+" "+a+":"+s+":"+r}},error:function(e,t,o){}});